{% extends 'shastra_compedium/generic_list.tmpl' %}
{% load thumbnail %}
{% block control_buttons %}
  {% for position,details in items.items %}
    {% for source,verses in details.sources.items %}
        {% include "shastra_compedium/detail_modal.tmpl"%}
    {% endfor %}
  {% endfor %}
{% endblock %}
{% block extra_text %}<div class="px-2">
Original Source Abbreviations:
<ul>
  {% for shastra in shastras %}
  <li>{{ shastra.initials }} - {{ shastra.title }}, by {{ shastra.author }}</li>
  {% endfor %}
</ul></div>
{% endblock %}
{% block table_header %}
    <tr>
          <th data-field="position" data-sortable="true">Position</th>
          <th data-field="category" data-sortable="true">Category</th>
          <th data-field="order" data-sortable="true">Order</th>
    {% for source in sources %}
          <th data-field="{{source.pk}}" data-sortable="false"><span title="{{source.title}} - {{source.translator}}">{{source.shastra.initials}}<br>{{source.short_form|safe}}</span></th>
    {% endfor %}
          <th data-field="action">Action</th>
      </tr>
{% endblock %}
{% block buttons %}
      btnAdd: {
        text: 'Add new row',
        icon: 'fa-plus',
        event: function () {
          window.location.href = "{% url 'shastra_compedium:position-add' %}";
        },
        attributes: {
          title: 'Add a new item to the inventory',
        }
      }
{% endblock %}
{% block details %}
    var html = []
    html.push('<div class="row"><div class="col-12 py-2">')
    html.push('<a href="' + row.edit_url + '" class="btn lakshmi-btn-primary">Edit Details for ' + row.position + '</a>')
    html.push('</div></div>')
    html.push('<div class="row">')
    html.push(row.images)
    html.push('</div>')
    html.push('<div class="row">')
    html.push('<div class="col-12"><table class="table lakshmi-table"><thead class="thead-dark"><tr><th>Source</th><th>Posture Description</th><th>Meaning</th></tr></thead><tbody>' + row.details + '</tbody></table></div>')
    html.push('</div>')
    return html.join('')
{% endblock %}
{% block item_data %}
  {% for position,details in items.items %}
      {
        'edit_url': '{% url 'shastra_compedium:position-detail-update' position.id %}?next={{request.path}}',
        'id': {{ position.pk}},
        'position': '{{ position.name }}',
        'category': '{% if position.category %}{{ position.category }}&nbsp;&nbsp;<a class="lakshmi-detail" href="{% url 'shastra_compedium:category-update' position.category.pk %}?next={{request.path}}" title="Edit"><i class="fas fa-edit"></i></a>{% endif %}',
        'order': '{{ position.order }}',
    {% for source,verses in details.sources.items %}
        '{{source.pk}}': '<a class="lakshmi-text-success" href="#" data-toggle="modal" data-target="#Modal{{source.pk}}_{{ position.pk }}" data-backdrop="true" ><i class="far fa-check-square fa-4x"></i></a>',
    {% endfor %}
        'details': '{% for source,verses in details.sources.items %}<tr><td class="align-top" rowspan="{{verses.num_details}}">{{ source.title }} ({{source.shastra.initials}}) - {{source.translator}}</td>{% for detail in verses.PostureDescription %}{% if not forloop.first %}<tr>{% endif %}<td class="align-top">{% for image in detail.detail_images %}{% include "shastra_compedium/image_overlay.tmpl" with extra="col-6 float-left"%}{% endfor %}<b>{{detail.verses}}:</b>  {{detail.contents|escapejs|safe}}</td><td class="align-top">{% for meaning in detail.meaning.all %}{% for image in meaning.detail_images %}{% include "shastra_compedium/image_overlay.tmpl" with extra="col-6 float-left"%}{% endfor %}<b>{{meaning.verses}}:</b>  {{meaning.contents|escapejs|safe}}<br>{% empty %}<i>No associated meanings</i>{% endfor %}</td></tr>{% endfor %}{% if verses.Meaning|length > 0 %}<tr><td class="align-top"><i>No associated description</i></td><td class="align-top">{% for detail in verses.Meaning %}<b>{{detail.verses}}:</b>  {{detail.contents|escapejs|safe}}{% endfor %}</td></tr>{% endif %}{% endfor %}',
        'images': '{% for image in details.images %}{% include "shastra_compedium/image_overlay.tmpl" with extra="col-sm-4 col-lg-3" %}{% endfor %}',
        'action': '<a class="lakshmi-detail" href="{% url 'shastra_compedium:position-update' position.pk %}" title="Edit"><i class="fas fa-edit"></i></a>',
      },
  {% endfor %}
{% endblock %}